# WordPress Poster

Post markdown files with frontmatter to WordPress via REST API. Converts markdown to proper Gutenberg blocks.

## Installation

```bash
git clone https://github.com/adam-marash/wp-poster
cd wp-poster
./install.sh
```

## Usage

```bash
# First-time setup
wp-post --init

# Post a markdown file
wp-post my-post.md

# Post as draft
wp-post my-post.md --draft

# Post pre-formatted Gutenberg HTML (no conversion)
wp-post my-file.html --raw

# Test mode - preview without posting
wp-post my-post.md --test
wp-post my-file.html --test --raw
```

## Configuration

Three ways to configure:
1. **Interactive**: `wp-post --init` (creates `.wp-poster.json` in current directory)
2. **Environment variables**: `WP_SITE_URL`, `WP_USERNAME`, `WP_APP_PASSWORD`
3. **Command line**: `--site-url`, `--username`, `--app-password`

### Config File Discovery

Config files are searched in this order (first match wins):
1. **Local/project**: Walks up from current directory to find nearest `.wp-poster.json`
2. **User global**: `~/.wp-poster.json`
3. **XDG config**: `~/.config/wp-poster/config.json`
4. **App default**: Script directory `.wp-poster.json`

This means project-specific configs override global configs, and running from `/project/src/deep/` will find `/project/.wp-poster.json`.

### Credential Validation
Running `wp-post my-file.md` without credentials will show helpful error messages:
- Lists exactly which credentials are missing
- Suggests `wp-post --init` for interactive setup
- Shows all configuration options with examples

## Frontmatter

```yaml
---
title: Post Title
slug: post-slug
status: draft|publish
excerpt: Post excerpt
post_type: post|page|custom-post-type
featured_image: image.jpg|https://example.com/image.jpg
categories: [Cat1, Cat2]  # posts only, auto-created if missing
tags: [tag1, tag2]        # posts only, auto-created if missing
taxonomies:
  custom_taxonomy: Term Name  # any taxonomy, auto-created if missing
meta:
  custom_field: value
acf:
  field_name: value
date: 2025-01-01T10:00:00
---
```

## Supported Markdown

- **Headings**: `# ## ###`
- **Text**: **bold**, *italic*, ~~strikethrough~~
- **Lists**: ordered (1. 2. 3.) and unordered (- * +) with nesting
- **Links**: `[text](url)`
- **Images**: `![alt](path)` - uploads local/remote to WordPress
- **Blockquotes**: `>` including multi-line
- **Code blocks**: ``` with syntax highlighting
- **Tables**: `| header | header |`
- **Shortcodes**: `[gallery]` - passed through to WordPress

## Raw Mode

Use `--raw` to post pre-formatted Gutenberg HTML without any markdown conversion. Useful for:
- Posting translated content that's already formatted
- Migrating existing Gutenberg content
- Content generated by other tools

```bash
wp-post --raw my-file.html
wp-post --raw --draft my-file.html
wp-post --raw --test my-file.html  # preview without posting
```

Raw mode still parses YAML frontmatter for title, slug, excerpt, taxonomies, etc. Only the content body is posted as-is.

Example file:
```html
---
title: My Pre-formatted Post
slug: my-post
status: publish
---
<!-- wp:paragraph -->
<p>This content is posted exactly as written.</p>
<!-- /wp:paragraph -->
```

## Testing & Development

### Test Mode
Debug markdown-to-Gutenberg conversion without WordPress credentials:

```bash
# Test conversion without posting
wp-post my-file.md --test

# Shows frontmatter and generated Gutenberg blocks
# Useful for debugging formatting issues
```

### Full Integration Test
```bash
# Test all features (before install.sh)
./wp-post comprehensive-test.md

# After install.sh, can use globally:
wp-post comprehensive-test.md

# Check WordPress admin to verify Gutenberg blocks render correctly
```

## Recent Improvements

- **Raw mode**: Use `--raw` flag to post pre-formatted Gutenberg HTML without conversion
- **Smart config discovery**: Walks up directory tree to find project configs; local overrides global
- **Taxonomy auto-creation**: Categories, tags, and custom taxonomy terms are created if they don't exist
- **Fixed list generation**: Lists now properly group all items in a single block
- **Fixed content ordering**: Paragraphs appear in correct order relative to lists and headings
- **Test mode**: Use `--test` flag to preview Gutenberg blocks without posting